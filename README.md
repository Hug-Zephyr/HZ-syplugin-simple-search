> 一个为思源笔记设计的增强型搜索插件，支持通过输入指令字符灵活控制搜索行为。

---

## 📣 写在前面

- 本插件的**核心逻辑与使用方式**参考自 [简易搜索插件](https://github.com/choyy/simple-search)。
- 若你从中受益，请感谢原作者：[choyy](https://github.com/choyy)，或通过[爱发电支持他](https://afdian.com/a/chooyy)。
- 本人仅为二次开发与功能扩展，**非原作者**。如有问题请联系我（见下文），但感谢请归于原作者。
- 致 choyy 大佬：感谢开源，侵删即改！

---

## ⚠️ 非常重要！

1. **版本要求**：本插件基于思源笔记 **v3.2.1+** 新增的事件接口实现，**最低需使用 v3.2.1 或更高版本**。
2. **互斥警告**：本插件与「简易搜索」插件**完全互斥**。若要使用本插件，请务必**彻底卸载「简易搜索」**（仅关闭开关无效）。
3. **遇到问题？**
   - 先尝试重启思源笔记；
   - 若仍存在异常，请前往 [链滴社区 @HugZephyr](https://ld246.com/member/HugZephyr) 联系我，或在[链滴帖子](https://ld246.com/article/1754277290689)下留言，或提交 [GitHub Issue](https://github.com/Hug-Zephyr/HZ-syplugin-simple-search/issues)。

---

## 🔧 使用方法

本插件兼容原「简易搜索」的全部功能，可无缝切换使用。

在搜索框中输入格式：  
`-<指令字符> <关键词>`: 即可实现对搜索方式、块类型、路径等的精准控制。

例如：
`-dhc 历史用户`: 表示搜索包含“历史用户”的**文档块(`d`)**、**标题块(`h`)** 和 **代码块(`c`)**。

---

## ✨ 功能详解

### 1. 指定搜索方式

当输入内容包含插件可识别的指令（如 `-dh`）时，会自动转换为 SQL 查询。  
若想**强制使用某种搜索模式**，可通过以下字符指定：

| 字符 | 模式             |
|------|------------------|
| `w`  | 关键字搜索       |
| `q`  | 查询语法         |
| `s`  | SQL 语句         |
| `r`  | 正则表达式       |

> ✅ 指定后会自动勾选对应搜索模式，无需手动勾选。  
> ❌ 若不希望触发插件解析，避免以 `-` 开头或使用未注册字符。

#### 示例

- `-w-dh`：以**关键字模式**搜索包含 `-dh` 的内容  
  ![](img/search_method_keyword.png)
- `-q中国历史 NOT 苏联`：使用查询语法排除“苏联”  
  ![](img/search_method_query.png)
- `-sselect * from blocks where content like '%历史%';`：执行原生 SQL  
  ![](img/search_method_sql.png)

> 这里的四个字符必须放在前面才会生效, `中国历史 -w`是不会被识别到的
---

### 2. 指定块类型（核心功能）

#### (1) 默认行为
未指定块类型时，沿用搜索页面当前勾选的类型。

![](img/block_type_def.png)

#### (2) 自定义过滤
使用 `-` + `类型字符`，精确筛选目标块类型。

例如：
`历史 -dhi`或`-dhi 历史`: 表示搜索包含“历史”的**文档块(`d`)**、**标题块(`h`)**、**列表项块(`i`)**，结果也按此顺序排序。

![](img/block_filting.png)

#### ✅ 支持的块类型

> 可通过插件新增的帮助面板随时查看。

| 字符 | 类型说明 |
|------|----------|
| `d` | 文档块（仅匹配文档名） |
| `h` | 标题块（仅匹配标题文本）<br>支持等级过滤：`h`+数字1-6，如 `-h13` 表示搜索 1, 3 级标题 |
| `p` | 段落块 |
| `c` | 代码块 |
| `b` | 引述块 |
| `L` | **大写 L**：含外部链接的块（非标准类型） |
| `l` | **小写 l**：列表块（有序/无序/任务列表） |
| `i` | 列表项块 |
| `s` | 超级块 |
| `t` | 表格块 |
| `m` | 数学公式块 |
| `o` | **小写 o**: 未完成待办项（todo） |
| `O` | **大写 O**: 已完成待办项（done） |

---

### 3. 指定搜索路径

#### (1) 默认路径
未指定时，沿用搜索面板当前选定的路径范围。

![](img/search_path_def.png)

#### (2) 指定笔记本

- `a`：全部已打开的笔记本
- `a` + 数字（1-9）：指定第 N 个打开的笔记本  
  示例：`-a13` → 在第 1 和第 3 个打开的笔记本中搜索

#### (3) 指定当前文档

- `k`：**小写 k**仅当前文档
- `K`：**大写 K**当前文档及其子文档

> ✅ 可与其他过滤条件组合使用。

##### 示例
`历史 -中苏 -kphi` → 在当前文档中搜索含“历史”但不含“中苏”的段落(`p`)、标题(`h`)、列表项(`i`)块。

![](img/current_doc_search.png)

#### (4) 多层路径匹配（使用 `/`）

通过 `/` 指定路径中的层级关键词（无需 `-` 前缀）：

- **无关键词时**：仅搜索文档名称
  `/笔记本1/文档1/文档2`  → 匹配路径含 `笔记本1`,`文档1` 且文档名为 `文档2` 的文件。

  ![](img/custom_path_only.png)

- **有关键词时**：按关键词搜索 + 路径匹配
  `/文档1/文档3 中国历史 -hp`  → 搜索路径包含 `文档1`,`文档3` 且内容含“中国历史”的标题块(`h`)和段落块(`p`)。

  ![](img/custom_path_all1.png)  
  ![](img/custom_path_all2.png)

> 🔍 **注意**：
> 1. 默认路径、指定笔记本(`a`)、当前文档(`k/K`)互斥，三者只能选其一；
> 2. 多层路径可与上述任一路径条件**组合使用（AND 关系）**；
> 3. 路径为**模糊匹配但顺序严格**：
>    - `/f1/f3` 可匹配 `/f1/f2/f3` 或 `/ff11/f2/f3`
>    - 但不能匹配 `/f3/f1`

---

### 4. 其他高级功能

#### 🔺 关键词排除

在关键词后添加 `-`+`排除词`，实现排除特定内容。

支持多关键词排除，并可与块类型组合。

##### 示例
`历史 -中苏 -美国 -dhi` → 搜索含“历史”但不含“中苏”和“美国”的文档/标题/列表项块。

![](img/keywords_exclusion.png)

#### 🔺 搜索范围扩展（-e）

使用 `-e` 实现跨文档联合搜索：

`中国历史 -e` → 搜索**同时包含“中国历史”和“苏联历史”** 的文档。

> ⚠️ 注意：
> - `-e` **不可**与块类型过滤、当前文档搜索（`k/K`）共用；
> - 需配合“保存的查询条件”或手动输入第二个关键词使用。

![](img/search_extension.png)

---

## 🛠️ 其他功能与特性

### 💡 辅助信息显示框

搜索页面新增两个按钮和一个信息展示区：
> 方便调试与确认搜索意图是否正确解析。

![](img/help_info_btn.png)

- **开关按钮**：控制信息框的显示/隐藏
- **帮助按钮**：在信息框里, 展示所有支持的过滤语法
  ![](img/help_info.png)
- **信息显示框**：实时显示经插件转换后的实际搜索语句
  ![](img/assist_info_1.png)


---

### ✅ 其他优化体验

- 搜索框默认填充**最近一次非空输入**
- 适配**搜索历史记录**：点击历史项仍可被插件识别
- 适配**查询条件**：点击查询条件后仍可正常解析指令
- 当无匹配文档时，**禁用回车创建新文档**，防止误操作  
  ![](img/forbid_enter_create_file.png)
- 搜索结果排序规则：  
  `笔记本ID升序 → 路径名称升序 → 更新时间降序`

---

## 🐞 已知问题（待处理）

* `k/K`暂时无法使用
* 帮助信息缺少 sm的用法
* 辅助信息: 直接使用关键词时, 类型没有识别出来

* 当前排序尚未完全优化，可能不符合预期, 排序增加使用
* 扩展搜索 `-e` 适配不够完善

---

## 🍰 未来规划（画饼）

> （以下功能暂无排期）

- [ ] 打开搜索框填充上次内容时，若以 `-d` 等开头，光标仅选中空格后部分
- [ ] 输入时显示下拉框，实时更新匹配到的搜索历史
- [ ] sql无法替换  
    方案1: 模拟替换请求
    方案2: 增加按钮, 点击后, 将sql转成正常的方式
- [ ] 添加独立设置页面（配置默认行为、快捷键等）
- [ ] 在搜索页面增加插件启用/禁用开关

---

## 📅 更新日志

### [2025/08/01 23:34:49] `release_v1.0`
- ✅ 初始发布版本，实现基础功能集
- ✅ 支持块类型过滤、路径控制、搜索方式切换、关键词排除等核心功能
- ✅ 提供辅助信息面板与帮助文档

---

## 🤝 贡献与反馈

- GitHub 仓库：[HZ-syplugin-simple-search](https://github.com/Hug-Zephyr/HZ-syplugin-simple-search)
- 提交 Issue：[点击提交问题](https://github.com/Hug-Zephyr/HZ-syplugin-simple-search/issues)
- 社区交流：[链滴 @HugZephyr](https://ld246.com/member/HugZephyr)

---

> 感谢你使用本插件！愿你在知识管理的路上越走越远 🌿